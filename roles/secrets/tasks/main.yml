---
- name: Copy K8s secrets for GoFLights
  ansible.builtin.copy:
    src: /home/rahul/ansible-vm-automation/vars/k8s-goflights-secrets.yml
    dest: /tmp/k8s-goflights-secrets.yml
    owner: root
    group: root
    mode: '0600'

- name: Apply K8s GoFlights Secrets YAML manifests
  kubernetes.core.k8s:
    src: /tmp/k8s-goflights-secrets.yml
    state: present
    kubeconfig: "{{ kubeconfig_path }}"

- name: Create Docker registry secrets
  ansible.builtin.shell: |
    kubectl create secret docker-registry docker-credentials \
      --namespace="{{ item }}" \
      --docker-server="{{ DOCKER_REGISTRY_SERVER }}" \
      --docker-username="{{ DOCKER_USER }}" \
      --docker-password="{{ DOCKER_PASSWORD }}" \
      --docker-email="{{ DOCKER_EMAIL }}" 
  environment:
    KUBECONFIG: "{{ kubeconfig_path }}"
  loop:
    - ci-cd-app
    - goflights
    - sql